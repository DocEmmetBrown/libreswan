/testing/guestbin/swan-prep
west #
 ipsec start
Redirecting to: [initsystem]
west #
 ../../guestbin/wait-until-pluto-started
west #
 # sourceip is shown as {my,their}_ip=
west #
 add() { ipsec auto --add $1 ; ipsec whack --connectionstatus --name $1 | grep _ip= ; }
west #
 # fails because there's no subnet=
west #
 add sourceip-without-selector
036 "sourceip-without-selector": failed to add connection: leftsourceip=1.0.0.1 invalid, requires leftsubnet
west #
 add sourceips-without-selector
036 "sourceips-without-selector": failed to add connection: leftsourceip=1.0.0.1,1::1 invalid, requires leftsubnet
west #
 # fails because sourceip is not within subnet
west #
 add sourceip-outside-selector
036 "sourceip-outside-selector": failed to add connection: leftsourceip=1.0.0.1 address 1.0.0.1 is not within leftsubnet=2.0.0.0/24
west #
 # fails because sourceip is not within subnet
west #
 add sourceips-outside-selectors
036 "sourceips-outside-selectors": failed to add connection: leftsourceip=1.0.0.1,1::1 address 1::1 is not within leftsubnet=2::/64,1.0.0.0/24
west #
 # all good
west #
 add sourceip-inside-selector
002 "sourceip-inside-selector": added IKEv2 connection
000 "sourceip-inside-selector":     oriented; my_ip=1.0.0.1; their_ip=unset; my_updown=ipsec _updown;
west #
 add sourceips-inside-selectors
002 "sourceips-inside-selectors": connection is using multiple subnet
002 "sourceips-inside-selectors": added IKEv2 connection
000 "sourceips-inside-selectors":     oriented; my_ip=1::1; their_ip=unset; my_updown=ipsec _updown;
000 "sourceips-inside-selectors":     oriented; my_ip=1::1; their_ip=unset; my_updown=ipsec _updown;
west #
 # subnets= tests can't check inside/outside
west #
 add sourceip-outside-subnets
002 "sourceip-outside-subnets/1x0": added IKEv2 connection
000 "sourceip-outside-subnets/1x0":     oriented; my_ip=unset; their_ip=unset; my_updown=ipsec _updown;
west #
 add sourceip-inside-subnets
002 "sourceip-inside-subnets/1x0": added IKEv2 connection
000 "sourceip-inside-subnets/1x0":     oriented; my_ip=1.0.0.1; their_ip=unset; my_updown=ipsec _updown;
west #
 add sourceips-inside-subnets
002 "sourceips-inside-subnets/0x1": connection is using multiple sourceip
002 "sourceips-inside-subnets/0x1": added IKEv2 connection
002 "sourceips-inside-subnets/1x2": connection is using multiple sourceip
002 "sourceips-inside-subnets/1x2": added IKEv2 connection
000 "sourceips-inside-subnets/1x2":     oriented; my_ip=1.0.0.1; their_ip=unset; my_updown=ipsec _updown;
000 "sourceips-inside-subnets/0x1":     oriented; my_ip=1::1; their_ip=unset; my_updown=ipsec _updown;
west #
 
